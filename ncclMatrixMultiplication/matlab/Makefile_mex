
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
# Ready for compiler gcc 4.9                            %
#%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
CUDA_LIB_PATH=/usr/local/cuda/lib64
CUDA_LIB=cuda
CUDA_RT=cudart
CUBLAS=cublas
NCCL=nccl
CURAND=curand
CUSTOM_INCLUDE_CUDA=../include/cuda
CUSTOM_INCLUDE_CPP=../include/cpp
CUSTOM_SRC_CUDA_DIR=../src/cuda
CUSTOM_SRC_CPP_DIR=../src/cpp
CUSTOM_SRC_CUDA_SOURCES=$(wildcard $(CUSTOM_SRC_CUDA_DIR)/*.cuda)
CUSTOM_SRC_CPP_SOURCES=$(wildcard $(CUSTOM_SRC_CPP_DIR)/*.cpp)
MATLAB_INCLUDE_PATH=/usr/local/MATLAB/R2015b/extern/include

call_gpu.mexa64: call_gpu.o
	mex call_gpu.o -cxx -L$(CUDA_LIB_PATH) -l$(CUDA_LIB) -l$(CUDA_RT) -l$(CUBLAS) -l$(NCCL) -l$(CURAND)

call_gpu.o: call_gpu.cu Matrix.h
	nvcc --std=c++11 -c call_gpu.cu $(CUSTOM_SRC_CUDA_SOURCES) $(CUSTOM_SRC_CPP_SOURCES) -I$(MATLAB_INCLUDE_PATH) -I$(CUSTOM_INCLUDE_CUDA) -I$(CUSTOM_INCLUDE_CPP) -arch=compute_50 --compiler-options -fPIC

clean:
	rm -f call_gpu.mexa64 *.o
